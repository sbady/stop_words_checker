# Проверка статей на стоп-слова (BAN-слова)

Этот репозиторий содержит инструмент для проверки документации/статей на наличие стоп-слов (запрещённых терминов и формулировок).

Инструмент умеет:
- Обходить страницы документации, извлекать основной текст и искать стоп-слова.
- Показывать отчёт в консоли с контекстом каждого найденного совпадения.
- Сохранять полный отчёт в JSON (опционально).
- Настраивать «разрешённые контексты» через `allow:` (например, слово запрещено само по себе, но допустимо внутри конкретной фразы).

## Быстрый старт

### 1) Установка зависимостей

Нужен Python 3.10+ (обычно подойдёт и 3.9+, если пакеты ставятся без проблем).

Установите зависимости:

```bash
pip install requests beautifulsoup4
```

Рекомендуется работать в виртуальном окружении (`.venv`).

### 2) Настройка `.env`

В корне проекта лежит пример: `.env.example`.

Минимально нужны:
- `URL` — базовый URL документации (например, `https://docs.wecloud.events/ru/`)
- `STOP_WORDS_FILE` — путь к файлу стоп-слов (обычно `stopwords.txt`)

Пример:

```env
URL=https://docs.wecloud.events/ru/
STOP_WORDS_FILE=stopwords.txt
```

### 3) Запуск полного обхода

```bash
python stopword_crawler.py
```

Полезные опции:
- `--url` — переопределить стартовый URL (иначе берётся из `.env`)
- `--stop-words` — путь к файлу стоп-слов (иначе берётся из `.env:STOP_WORDS_FILE`)
- `--delay` — задержка между запросами (по умолчанию 0.5 сек)
- `--max-pages` — ограничить количество страниц
- `--output` — сохранить JSON-отчёт в файл
- `--env` — путь к `.env` (по умолчанию `.env`)

Пример:

```bash
python stopword_crawler.py --max-pages 50 --output report.json
```

### 4) Проверка одной страницы (debug)

```bash
python debug/check_single_page.py --path documentation/first_steps/reg.html --stop-words stopwords.txt
```

`--path` может быть:
- относительным путём (как в примере выше), или
- полным URL (`https://...`).

## Как работает поиск стоп-слов (уровень пользователя)

- По умолчанию поиск регистронезависимый.
- Обычные строки (без `re:`) ищутся как «целое слово/фраза» (по границам `\b...\b`).
- Строки, начинающиеся с `re:`, считаются регулярным выражением Python.
- Для каждого найденного совпадения выводится короткий контекст вокруг него.

## Формат `stopwords.txt` (словарь стоп-слов)

Файл `stopwords.txt` — это список правил, по одному на строку.

Поддерживаются:
1) **Стоп-слово или стоп-фраза** (обычная строка).
2) **Регулярка**: строка начинается с `re:`.
3) **Исключения (разрешённые контексты)** для предыдущего стоп-слова: строки, начинающиеся с `allow:`.

Также:
- Пустые строки игнорируются.
- Строки, начинающиеся с `#`, считаются комментариями и игнорируются.

### 1) Обычное стоп-слово/фраза

Пример:

```text
рейтинг
покупка
платное мероприятие
```

Обычные строки ищутся как целое слово/фраза. Если вам нужно искать «часть слова» (например, все формы `платн...`) — используйте `re:`.

### 2) `re:` — регулярные выражения

Пример:

```text
re:платн\w*
re:куп(ить|ка)
```

Примечания:
- Это регулярки Python (`re`), поиск регистронезависимый.
- В `stopwords.txt` допускается писать экранирование как `\\s`, `\\w` и т.п. — скрипт приведёт это к `\s`, `\w` при компиляции.

### 3) `allow:` — разрешённые контексты (исключения)

`allow:` относится **только к предыдущему стоп-слову** (к последней строке-стопслову выше).

`allow:` можно задавать:
- как обычную фразу, или
- как regex через `allow: re:...`

Если найденное стоп-слово **пересекается** с allow-фразой/allow-regex (в небольшом окне вокруг совпадения), тогда совпадение **пропускается** и не попадает в отчёт.

#### Пример: слово запрещено, но допустимо в составе конкретной фразы

Запрещено слово `рейтинг`, но допустимо `опрос-рейтинг`:

```text
рейтинг
allow: опрос-рейтинг
allow: re:опрос[\s-]+рейтинг
```

#### Пример: «контроль присутствия» разрешён только для офлайн-участников

```text
контроль присутствия
allow: контроль присутствия офлайн-участников
allow: re:контроль\s+присутствия\s+офлайн[- ]участник\w*

включение контроля присутствия
allow: Включение контроля присутствия офлайн-участников
allow: re:включение\s+контроля\s+присутствия\s+офлайн[- ]участник\w*
```

Важно:
- `allow:` нужно размещать сразу под тем стоп-словом, к которому он относится (до следующего стоп-слова).

## Типовые ошибки при заполнении `stopwords.txt`

- `allow:` стоит не под тем стоп-словом (он применяется только к предыдущему правилу).
- Нужна «часть слова», но правило задано обычной строкой — используйте `re:`.
- Опечатки в регулярке (`re:` / `allow: re:`) — такие правила будут пропущены с предупреждением в stderr.

